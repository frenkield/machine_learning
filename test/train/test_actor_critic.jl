using Test
using Random

include("../../src/environments/cartpole.jl")
include("../../src/mlp/mlp.jl")
include("../../src/mlp/propagate.jl")
include("../../src/mlp/actions.jl")
include("../../src/train/networks.jl")
include("../../src/train/actor_critic.jl")

function test_1()

    Random.seed!(34587)
    actor_network = ActorNetwork()
    critic_network = CriticNetwork()

    cartpole = CartPole()
    reset!(cartpole, [-2.1598, -1.6722, -0.1091, -0.0376])

    train_actor_critic!(actor_network, critic_network, cartpole, iterations=1000)
    @test actor_network.mlp.weights[3].values_with_bias == [0.07910043060727531 0.180509020961262 0.03412440731564908 -0.008023670954259876 -0.04295001186143977 0.2145520278364218 -0.3240332712565815 0.11690528453143284 0.09553934984844432 0.19147906585578534 -0.21399066599755684 -0.12045434286783684 0.21318083448407513 -0.0796530749188639 0.017822022355543837 0.09303908436470974 -0.09560551896550404 -0.1765245681140589 0.12801127211028046 -0.1292497446056536 -0.10280489218253266 -0.13206151125257523 -0.15318105797054207 0.09915281980400777 0.007880793367967107 -0.2558217580424111 0.04513104271575956 0.0664578322583817 0.08235326574103842 0.043259319343733664 -0.13976345917049954 0.026033312868367395 0.24648223707872666 -0.24238960066845747 -0.057632668898877075 -0.16374460905069163 -0.06245934676270836 0.07218615427958337 0.06430054142449554 0.20274087523131132 -0.11667531337318617 0.2006851367773944 0.07617364160907907 -0.257322273804406 0.06924193190301045 0.22485931271721665 0.12905954325533556 -0.02486700039046577 -0.08379637547206603 -0.006170357381496127 -0.06797980254848451 -0.15108847858074606 0.044359094409972766 0.0031535019490361114 -0.03171903614578916 -0.026291055041826366 -0.005694524113454715 0.15497810836714773 0.01400071479526988 0.0856563646038908 0.14066822438527776 -0.048986639039772455 0.029396336030202443 -0.017677326893184225 0.0014075113519319824; -0.2592350393102664 0.09990429502133438 -0.0151682474556245 0.0795451547032408 0.24234560620534099 -0.21791888611163268 -0.11259152718419038 0.18016340910999498 -0.21078931527421896 0.0012964730167526822 -0.07066284048844197 -0.21373829614215406 0.011651244304136204 -0.20266025599595727 -0.15467330039705682 0.11417935422601853 0.14599860624759234 0.15633515846287052 -0.14393300094630826 0.019042766524167115 -0.28754477583354154 0.08079726658093732 0.021811419116776636 0.0954706045239198 -0.16582858415052 -0.012256681777419245 0.09589744169806355 0.19221311988764977 -0.08346638279882647 0.1637899763802623 0.12197459685098803 0.07324138037512747 -0.03535579697351283 -0.055197265912518396 -0.07639195365114362 0.09628473317946663 -0.19582859984492182 -0.17558764005934202 0.18151061955392303 0.02352369600735261 0.1918424569589914 0.02957591795914472 0.017053366927216936 0.0857109277737627 -0.00399112261669767 0.061950212963868496 -0.07437595515001592 0.07042377866692351 -0.0007367480496664262 0.021674200782140923 0.09219012292831393 -0.018414315346214075 0.22140239618858254 0.007643242391026111 -0.22379830126579436 0.09556363977784893 0.1589348209597249 0.1134206884590286 -0.10244627367375957 0.002148384336627892 0.0626238400518467 -0.18853777884720585 -0.23845157353678484 -0.18823547979787386 -0.001407511351931951]

end

function test_2()

    Random.seed!(31415927)
    actor_network = ActorNetwork()
    critic_network = CriticNetwork()

    cartpole = CartPole()
    reset!(cartpole, [0.0, 0.0, 0.01, 0.0])

    train_actor_critic!(actor_network, critic_network, cartpole, iterations=10000)
    @test actor_network.mlp.weights[3].values_with_bias == [0.07268830755442744 0.24486337453181678 0.12615164335028214 -0.09680530108502233 -0.043992971549057104 0.24809636676226715 0.18788771389411424 -0.03237345561876274 0.08840012264647776 0.12526471097879177 0.21626422550735774 -0.012235957091917694 0.08900465975041831 -0.04806950492538164 0.17361434925356672 0.26244275992423527 0.21975377206079455 -0.05264782598350777 -0.16199224906015497 0.04253586860725045 -0.16242820175051909 -0.05412834596798034 -0.09864289807802754 -0.07607523191713575 0.11632649289808702 0.20866105965502152 0.13777565465937633 -0.11627732075410788 0.20323199425165497 0.1530285162939139 -0.0010643433877401997 -0.05581489564071711 -0.19012657397227034 0.008537320592468662 -0.24335429859957133 0.09149141478391251 0.1575210042385169 0.05065356640467354 -0.03855558034435785 0.1302333601412556 -0.15411662156801129 0.33405521858738446 -0.18344923853372552 0.0755757006830542 -0.020131668217963188 0.0863843196542074 0.025817779708988048 -0.053461608082653156 0.3197268561506468 0.0940151874529271 0.2744137744816595 0.05083025231287249 0.0028329420193980966 0.16415481031221005 0.22305567912407828 -0.05236846874082304 -0.1568249969309205 0.058221593998354616 -0.07391367567330669 -0.02022983105851361 -0.00222530749211397 0.01778505917710467 -0.11065046725968061 0.13140061160926927 -0.023282668579468365; -0.2723776655352507 -0.06829016676997424 0.27247110389945545 0.0040380007702288745 -0.02999232881375497 -0.06341945537674248 0.13027712507443 0.3115188091383444 0.0738688242045024 -0.32649370132560596 -0.1265359619512622 0.13474310758472757 -0.10816834653907134 0.012013923933903598 -0.22796521299882838 -0.2823488316659005 -0.1783899990926773 0.17431171635349157 0.35104478441744963 -0.19408316845068832 -0.04936411542775807 -0.3326924437218326 -0.08954090958014456 0.15376465987658036 -0.19991125905650323 0.2496830687498993 -0.09899977274091502 0.1446619381336499 -0.018191947097635604 -0.28983282255018356 0.011489640472519254 -0.15239592445805386 0.07055872190067419 0.05098342021035584 -0.02415153658742934 -0.09035694723257219 -0.26293373721576685 -0.07596190072551527 -0.051802827949254074 -0.190999685011287 0.10162009103056413 0.03479414491404854 0.053425938001952694 -0.04005596291588215 0.192796595666581 0.1408654124455872 0.0013938648533111837 0.11503980253783937 0.07209771905524523 0.15898042264454515 -0.18449942532830516 0.09623124123179946 0.08488382774207624 -0.06573553519444382 0.053208347037486226 0.18178531951974464 -0.17425470747934602 -0.0735503621100408 0.04997724660298503 -0.06742362103778275 0.000765249156342131 -0.2075081034874108 -0.28412892253452976 0.19164125247259703 0.023282668579468424]

end

@testset "Actor Critic" begin
    test_1()
    test_2()
end
